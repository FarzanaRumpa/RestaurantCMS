{% extends "admin/base.html" %}
{% block title %}Contact Messages{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-envelope me-2"></i>Contact Messages</h2>
    <div class="btn-group">
        <a href="{{ url_for('admin.contact_messages', status='all') }}"
           class="btn btn-sm btn-{{ 'primary' if current_status == 'all' else 'outline-primary' }}">
            All ({{ stats.total }})
        </a>
        <a href="{{ url_for('admin.contact_messages', status='new') }}"
           class="btn btn-sm btn-{{ 'success' if current_status == 'new' else 'outline-success' }}">
            New ({{ stats.new }})
        </a>
        <a href="{{ url_for('admin.contact_messages', status='read') }}"
           class="btn btn-sm btn-{{ 'info' if current_status == 'read' else 'outline-info' }}">
            Read ({{ stats.read }})
        </a>
        <a href="{{ url_for('admin.contact_messages', status='replied') }}"
           class="btn btn-sm btn-{{ 'primary' if current_status == 'replied' else 'outline-primary' }}">
            Replied ({{ stats.replied }})
        </a>
        <a href="{{ url_for('admin.contact_messages', status='spam') }}"
           class="btn btn-sm btn-{{ 'danger' if current_status == 'spam' else 'outline-danger' }}">
            Spam ({{ stats.spam }})
        </a>
    </div>
</div>

<div class="card border-0 shadow-sm">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0 align-middle">
                <thead class="bg-light">
                    <tr>
                        <th class="px-4 py-3">From</th>
                        <th class="py-3">Subject</th>
                        <th class="py-3">Status</th>
                        <th class="py-3">Date</th>
                        <th class="py-3 text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for message in messages %}
                    <tr class="{{ 'table-warning' if message.status == 'new' else '' }}">
                        <td class="px-4">
                            <div class="fw-semibold">{{ message.name }}</div>
                            <small class="text-muted">{{ message.email }}</small>
                            {% if message.phone %}
                            <br><small class="text-muted"><i class="bi bi-telephone me-1"></i>{{ message.phone }}</small>
                            {% endif %}
                        </td>
                        <td>
                            <div>{{ message.subject or 'No subject' }}</div>
                            <small class="text-muted">{{ message.message[:80] }}...</small>
                        </td>
                        <td>
                            {% if message.is_spam %}
                                <span class="badge bg-danger">Spam</span>
                            {% elif message.status == 'new' %}
                                <span class="badge bg-success">New</span>
                            {% elif message.status == 'read' %}
                                <span class="badge bg-info">Read</span>
                            {% elif message.status == 'replied' %}
                                <span class="badge bg-primary">Replied</span>
                            {% elif message.status == 'archived' %}
                                <span class="badge bg-secondary">Archived</span>
                            {% else %}
                                <span class="badge bg-secondary">{{ message.status }}</span>
                            {% endif %}
                        </td>
                        <td class="text-muted small">
                            {{ message.created_at.strftime('%b %d, %Y %I:%M %p') if message.created_at else 'N/A' }}
                        </td>
                        <td class="text-end">
                            <div class="btn-group btn-group-sm">
                                <a href="{{ url_for('admin.view_contact_message', id=message.id) }}"
                                   class="btn btn-outline-primary" title="View">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <form action="{{ url_for('admin.delete_contact_message', id=message.id) }}"
                                      method="POST" class="d-inline"
                                      onsubmit="return confirm('Are you sure you want to delete this message?')">
                                    <button type="submit" class="btn btn-outline-danger" title="Delete">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="text-center py-5 text-muted">
                            <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                            <p class="mb-0">No messages found</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Pagination -->
{% if pagination.pages > 1 %}
<nav class="mt-4">
    <ul class="pagination justify-content-center">
        <li class="page-item {{ 'disabled' if not pagination.has_prev else '' }}">
            <a class="page-link" href="{{ url_for('admin.contact_messages', status=current_status, page=pagination.prev_num) if pagination.has_prev else '#' }}">
                Previous
            </a>
        </li>

        {% for page_num in range(1, pagination.pages + 1) %}
            {% if page_num == pagination.page %}
                <li class="page-item active"><span class="page-link">{{ page_num }}</span></li>
            {% elif page_num <= 2 or page_num > pagination.pages - 2 or (page_num >= pagination.page - 1 and page_num <= pagination.page + 1) %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('admin.contact_messages', status=current_status, page=page_num) }}">
                        {{ page_num }}
                    </a>
                </li>
            {% elif page_num == 3 or page_num == pagination.pages - 2 %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
        {% endfor %}

        <li class="page-item {{ 'disabled' if not pagination.has_next else '' }}">
            <a class="page-link" href="{{ url_for('admin.contact_messages', status=current_status, page=pagination.next_num) if pagination.has_next else '#' }}">
                Next
            </a>
        </li>
    </ul>
</nav>
{% endif %}

{% endblock %}

